<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>–ö–û–ú–ê–† - –ò–≥—Ä–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-overlay: rgba(0, 0, 0, 0.95);
            --bg-surface: rgba(255, 255, 255, 0.08);
            --bg-surface-light: rgba(255, 255, 255, 0.1);
            --text-primary: #fff;
            --text-secondary: #b0b0b0;
            --text-accent: #ff9800;
            --border-color: rgba(255, 255, 255, 0.1);
            --health-color: #ff5252;
            --health-empty: #444;
            --timer-green: #4CAF50;
            --timer-orange: #FF9800;
            --timer-red: #F44336;
            --button-bg: #ff9800;
            --button-text: #000;
            --button-hover: #ffb74d;
            --game-area-bg: rgba(0, 0, 0, 0.15);
            --shadow-color: rgba(0, 0, 0, 0.5);
            --inset-shadow: rgba(255, 255, 255, 0.05);
            --heart-color: #ff5252;
            --heart-empty: #555;
            --game-area-radius: 20px;
        }
        
        /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
        .light-theme {
            --bg-primary: #f5f5f5;
            --bg-secondary: #e8e8e8;
            --bg-overlay: rgba(255, 255, 255, 0.95);
            --bg-surface: rgba(0, 0, 0, 0.06);
            --bg-surface-light: rgba(0, 0, 0, 0.08);
            --text-primary: #1a1a1a;
            --text-secondary: #555;
            --text-accent: #ff6d00;
            --border-color: rgba(0, 0, 0, 0.15);
            --health-color: #ff5252;
            --health-empty: #ddd;
            --timer-green: #388e3c;
            --timer-orange: #f57c00;
            --timer-red: #d32f2f;
            --button-bg: #ff6d00;
            --button-text: #fff;
            --button-hover: #ff8f00;
            --game-area-bg: rgba(0, 0, 0, 0.05);
            --shadow-color: rgba(0, 0, 0, 0.1);
            --inset-shadow: rgba(0, 0, 0, 0.05);
            --heart-color: #ff5252;
            --heart-empty: #bbb;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.3s ease, color 0.3s ease;
            padding: 15px;
        }
        
        .game-wrapper {
            width: 100%;
            height: 100%;
            max-width: 800px;
            max-height: 1200px;
            position: relative;
            overflow: hidden;
            border-radius: var(--game-area-radius);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        @media (max-width: 768px) {
            .game-wrapper {
                max-width: 100%;
                max-height: 100%;
                border-radius: 0;
            }
            
            body {
                padding: 0;
            }
        }
        
        .game-container {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            border-radius: var(--game-area-radius);
            overflow: hidden;
        }
        
        .header {
            padding: 8px 12px;
            background-color: var(--bg-overlay);
            display: flex;
            flex-direction: column;
            gap: 8px;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            z-index: 10;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }
        
        .header-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        
        .stats-row-top {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
        }
        
        .stats-row-bottom {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        
        .stat-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-item {
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--text-primary);
            white-space: nowrap;
        }
        
        .stat-value {
            font-weight: bold;
            color: var(--text-accent);
            font-size: 14px;
            min-width: 25px;
            text-align: right;
        }
        
        .health-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .hearts {
            display: flex;
            gap: 3px;
        }
        
        .heart {
            font-size: 16px;
            color: var(--heart-color);
            transition: color 0.3s ease;
        }
        
        .heart.empty {
            color: var(--heart-empty);
        }
        
        .timer-container {
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 140px;
        }
        
        .timer-bar {
            flex: 1;
            height: 12px;
            background-color: var(--bg-surface-light);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            min-width: 100px;
        }
        
        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--timer-green) 0%, var(--timer-orange) 50%, var(--timer-red) 100%);
            border-radius: 6px;
            width: 100%;
            transition: width 0.1s linear;
        }
        
        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
            font-weight: bold;
            color: var(--text-primary);
            text-shadow: 0 0 2px var(--shadow-color);
            z-index: 2;
        }
        
        .controls-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-button {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--bg-surface);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid var(--border-color);
            font-size: 16px;
            transition: all 0.2s;
            color: var(--text-primary);
        }
        
        .control-button:hover {
            background-color: var(--bg-surface-light);
            transform: scale(1.1);
        }
        
        .control-button:active {
            transform: scale(0.95);
        }
        
        .control-button.muted {
            opacity: 0.6;
        }
        
        .game-area {
            flex: 1;
            position: relative;
            overflow: hidden;
            background-color: var(--game-area-bg);
            width: 100%;
            height: 100%;
            border-radius: 0 0 var(--game-area-radius) var(--game-area-radius);
        }
        
        .game-area-border {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            box-shadow: inset 0 0 0 1px var(--inset-shadow);
            border-radius: 0 0 var(--game-area-radius) var(--game-area-radius);
        }
        
        .insect {
            position: absolute;
            font-size: 38px;
            cursor: pointer;
            transition: transform 0.2s ease;
            z-index: 2;
            text-shadow: 0 0 10px var(--shadow-color);
            pointer-events: auto;
            transform: translate(-50%, -50%);
            will-change: transform;
            filter: drop-shadow(0 0 4px var(--shadow-color));
            transform-origin: center;
        }
        
        .insect:hover {
            transform: translate(-50%, -50%) scale(1.15);
        }
        
        .hit-effect {
            position: absolute;
            font-size: 48px;
            pointer-events: none;
            animation: hitAnim 0.5s forwards;
            z-index: 3;
            transform: translate(-50%, -50%);
        }
        
        @keyframes hitAnim {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(2.0); opacity: 0; }
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: var(--bg-overlay);
            z-index: 20;
            padding: 15px;
            text-align: center;
            overflow-y: auto;
            transition: background 0.3s ease;
            border-radius: var(--game-area-radius);
        }
        
        .title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--text-accent);
            text-shadow: 0 0 8px color-mix(in srgb, var(--text-accent) 50%, transparent);
        }
        
        .game-rules {
            background-color: color-mix(in srgb, var(--text-accent) 8%, transparent);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            max-width: 400px;
            border: 1px solid color-mix(in srgb, var(--text-accent) 15%, transparent);
        }
        
        .rules-title {
            font-size: 14px;
            color: var(--text-accent);
            margin-bottom: 8px;
        }
        
        .rules-list {
            text-align: left;
            padding-left: 15px;
        }
        
        .rules-list li {
            margin-bottom: 6px;
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.3;
        }
        
        .emoji-info {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
            max-width: 450px;
            padding: 0 5px;
        }
        
        .emoji-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 24px;
            width: 65px;
        }
        
        .emoji-desc {
            font-size: 10px;
            margin-top: 5px;
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.2;
        }
        
        .button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            margin-bottom: 15px;
        }
        
        .button {
            background-color: var(--button-bg);
            color: var(--button-text);
            border: none;
            border-radius: 25px;
            padding: 12px 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 10px color-mix(in srgb, var(--button-bg) 20%, transparent);
            min-width: 160px;
        }
        
        .button:hover {
            background-color: var(--button-hover);
            transform: translateY(-2px);
        }
        
        .button:active {
            transform: translateY(1px);
        }
        
        .stats-table {
            background-color: var(--bg-surface);
            border-radius: 10px;
            padding: 15px;
            margin: 10px;
            width: 90%;
            max-width: 350px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
        }
        
        .stats-title {
            font-size: 18px;
            margin-bottom: 12px;
            color: var(--text-accent);
        }
        
        .stats-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 13px;
            color: var(--text-primary);
        }
        
        .stats-item:last-child {
            border-bottom: none;
        }
        
        .score-value {
            font-weight: bold;
            color: var(--text-accent);
        }
        
        .game-over {
            color: var(--timer-red);
            font-size: 28px;
            margin-bottom: 12px;
        }
        
        .final-score {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        
        .hidden {
            display: none !important;
        }
        
        .urgent-timer {
            animation: timerPulse 0.8s infinite alternate;
        }
        
        .menu-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .footer-text {
            font-size: 11px;
            color: var(--text-secondary);
            text-decoration: underline;
            margin-top: 15px;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .footer-text:hover {
            color: var(--text-accent);
        }
        
        @keyframes timerPulse {
            0% { box-shadow: 0 0 3px color-mix(in srgb, var(--timer-red) 40%, transparent); }
            100% { box-shadow: 0 0 8px color-mix(in srgb, var(--timer-red) 70%, transparent); }
        }
        
        @media (max-height: 600px) {
            .title {
                font-size: 26px;
                margin-bottom: 10px;
            }
            
            .game-rules {
                padding: 10px;
                margin-bottom: 15px;
                max-width: 350px;
            }
            
            .rules-title {
                font-size: 13px;
            }
            
            .rules-list li {
                font-size: 11px;
                margin-bottom: 5px;
            }
            
            .emoji-info {
                margin-bottom: 15px;
                gap: 10px;
            }
            
            .emoji-item {
                width: 60px;
                font-size: 22px;
            }
            
            .button {
                padding: 10px 20px;
                font-size: 13px;
                min-width: 150px;
            }
            
            .insect {
                font-size: 34px;
            }
            
            .header {
                padding: 6px 10px;
                gap: 6px;
            }
            
            .menu-controls {
                margin-bottom: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .header {
                padding: 6px 8px;
                gap: 6px;
            }
            
            .stats-row-top {
                gap: 10px;
            }
            
            .stat-item {
                font-size: 11px;
            }
            
            .stat-value {
                font-size: 12px;
            }
            
            .timer-container {
                min-width: 120px;
            }
            
            .timer-bar {
                min-width: 80px;
            }
            
            .title {
                font-size: 24px;
            }
            
            .game-rules {
                max-width: 320px;
            }
            
            .emoji-item {
                width: 55px;
                font-size: 20px;
            }
            
            .button {
                padding: 8px 16px;
                font-size: 12px;
                min-width: 140px;
            }
            
            .insect {
                font-size: 32px;
            }
            
            .menu-controls {
                gap: 8px;
            }
            
            .controls-row {
                gap: 6px;
            }
            
            .control-button {
                width: 28px;
                height: 28px;
                font-size: 14px;
            }
        }
        
        @media (max-width: 380px) {
            .stats-row-top {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .stats-row-bottom {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            
            .timer-container {
                width: 100%;
            }
            
            .health-container {
                justify-content: center;
            }
            
            .controls-row {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div class="game-container">
            <!-- –≠–∫—Ä–∞–Ω –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã -->
            <div id="startScreen" class="screen">
                <h1 class="title">–ö–û–ú–ê–†</h1>
                
                <div class="game-rules">
                    <div class="rules-title">–ü—Ä–∞–≤–∏–ª–∞:</div>
                    <ul class="rules-list">
                        <li>–£–±–∏–≤–∞–π—Ç–µ –∫–æ–º–∞—Ä–æ–≤ ü¶ü, —Ç–∞—Ä–∞–∫–∞–Ω–æ–≤ ü™≥ –∏ –º—É—Ö ü™∞ —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ—á–∫–∏</li>
                        <li>–ò–∑–±–µ–≥–∞–π—Ç–µ –ø—á—ë–ª üêù –∏ –∂—É–∫–æ–≤ ü™≤ - –æ–Ω–∏ –æ—Ç–Ω–∏–º–∞—é—Ç –∑–¥–æ—Ä–æ–≤—å–µ</li>
                        <li>–°–æ–±–∏—Ä–∞–π—Ç–µ –±–æ–∂—å–∏—Ö –∫–æ—Ä–æ–≤–æ–∫ üêû –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è –∏ —Å–±—Ä–æ—Å–∞ —Ç–∞–π–º–µ—Ä–∞</li>
                        <li>–£ –≤–∞—Å –µ—Å—Ç—å 10 —Å–µ–∫—É–Ω–¥ —á—Ç–æ–±—ã —É–±–∏—Ç—å –∫–æ–º–∞—Ä–∞, –º—É—Ö—É, —Ç–∞—Ä–∞–∫–∞–Ω–∞ –∏–ª–∏ –±–æ–∂—å—é –∫–æ—Ä–æ–≤–∫—É!</li>
                        <li>–ö–∞–∂–¥—ã–π —É–±–∏—Ç—ã–π —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ç–∞–π–º–µ—Ä –Ω–∞ 10 —Å–µ–∫—É–Ω–¥</li>
                        <li>–ï—Å–ª–∏ —Ç–∞–π–º–µ—Ä –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç –Ω—É–ª—è - –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</li>
                    </ul>
                </div>
                
                <div class="menu-controls">
                    <div class="control-button" id="menuSoundControl" title="–ó–≤—É–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤">
                        üîä
                    </div>
                    <div class="control-button" id="menuThemeControl" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
                        üåì
                    </div>
                </div>
                
                <div class="button-container">
                    <button id="startButton" class="button">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
                    <button id="showStatsButton" class="button">–°–¢–ê–¢–ò–°–¢–ò–ö–ê</button>
                </div>
                
                <a href="https://t.me/kabinagames" target="_blank" class="footer-text">by Kabina Inc.</a>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
            <div id="statsScreen" class="screen hidden">
                <h2 class="stats-title">–°–¢–ê–¢–ò–°–¢–ò–ö–ê</h2>
                <div class="stats-table">
                    <div class="stats-item">
                        <span>–í—Å–µ–≥–æ –æ—á–∫–æ–≤:</span>
                        <span id="totalPoints" class="score-value">0</span>
                    </div>
                    <div class="stats-item">
                        <span>–†–µ–∫–æ—Ä–¥ –æ—á–∫–æ–≤ –∑–∞ –∏–≥—Ä—É:</span>
                        <span id="bestPoints" class="score-value">0</span>
                    </div>
                    <div class="stats-item">
                        <span>–õ—É—á—à–µ–µ –≤—Ä–µ–º—è –≤—ã–∂–∏–≤–∞–Ω–∏—è:</span>
                        <span id="bestTime" class="score-value">0 —Å–µ–∫</span>
                    </div>
                    <div class="stats-item">
                        <span>–í—Å–µ–≥–æ –∏–≥—Ä:</span>
                        <span id="totalGames" class="score-value">0</span>
                    </div>
                </div>
                
                <div class="menu-controls">
                    <div class="control-button" id="statsSoundControl" title="–ó–≤—É–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤">
                        üîä
                    </div>
                    <div class="control-button" id="statsThemeControl" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
                        üåì
                    </div>
                </div>
                
                <button id="backToMenuButton" class="button">–ù–ê–ó–ê–î –í –ú–ï–ù–Æ</button>
            </div>
            
            <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
            <div id="gameScreen" class="screen hidden">
                <div class="header">
                    <!-- –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞: –æ—á–∫–∏, –≤—Ä–µ–º—è, –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                    <div class="header-row stats-row-top">
                        <div class="stat-group">
                            <div class="stat-item">–û—á–∫–∏: <span id="score" class="stat-value">0</span></div>
                        </div>
                        
                        <div class="stat-group">
                            <div class="stat-item">–í—Ä–µ–º—è: <span id="time" class="stat-value">0</span> —Å–µ–∫</div>
                        </div>
                        
                        <div class="controls-row">
                            <div class="control-button" id="soundControl" title="–ó–≤—É–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤">
                                üîä
                            </div>
                            <div class="control-button" id="themeControl" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
                                üåì
                            </div>
                        </div>
                    </div>
                    
                    <!-- –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞: —Ç–∞–π–º–µ—Ä –∏ –∑–¥–æ—Ä–æ–≤—å–µ -->
                    <div class="header-row stats-row-bottom">
                        <div class="timer-container">
                            <div class="stat-item">–¢–∞–π–º–µ—Ä:</div>
                            <div class="timer-bar">
                                <div id="timerFill" class="timer-fill" style="width: 100%"></div>
                                <div id="timerText" class="timer-text">10</div>
                            </div>
                        </div>
                        
                        <div class="health-container">
                            <div class="hearts" id="heartsContainer">
                                <!-- –°–µ—Ä–¥–µ—á–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="game-area" id="gameArea">
                    <div class="game-area-border"></div>
                </div>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã -->
            <div id="gameOverScreen" class="screen hidden">
                <h2 class="game-over">–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</h2>
                <div class="final-score">–ù–∞–±—Ä–∞–Ω–æ –æ—á–∫–æ–≤: <span id="finalScore">0</span></div>
                <div class="final-score">–í—Ä–µ–º—è –≤—ã–∂–∏–≤–∞–Ω–∏—è: <span id="finalTime">0</span> —Å–µ–∫</div>
                <div class="final-score" id="endReason">–¢–∞–π–º–µ—Ä –∏—Å—Ç—ë–∫</div>
                
                <div class="stats-table">
                    <div class="stats-item">
                        <span>–ö–æ–º–∞—Ä–æ–≤ —É–±–∏—Ç–æ:</span>
                        <span id="endMosquitoes" class="score-value">0</span>
                    </div>
                    <div class="stats-item">
                        <span>–¢–∞—Ä–∞–∫–∞–Ω–æ–≤ —É–±–∏—Ç–æ:</span>
                        <span id="endCockroaches" class="score-value">0</span>
                    </div>
                    <div class="stats-item">
                        <span>–ú—É—Ö —É–±–∏—Ç–æ:</span>
                        <span id="endFlies" class="score-value">0</span>
                    </div>
                    <div class="stats-item">
                        <span>–ë–æ–∂—å–∏—Ö –∫–æ—Ä–æ–≤–æ–∫ —Å–æ–±—Ä–∞–Ω–æ:</span>
                        <span id="endLadybugs" class="score-value">0</span>
                    </div>
                    <div class="stats-item">
                        <span>–ü—á—ë–ª –≤—Å—Ç—Ä–µ—á–µ–Ω–æ:</span>
                        <span id="endBees" class="score-value">0</span>
                    </div>
                    <div class="stats-item">
                        <span>–ñ—É–∫–æ–≤ –≤—Å—Ç—Ä–µ—á–µ–Ω–æ:</span>
                        <span id="endBeetles" class="score-value">0</span>
                    </div>
                </div>
                
                <div class="menu-controls">
                    <div class="control-button" id="gameOverSoundControl" title="–ó–≤—É–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤">
                        üîä
                    </div>
                    <div class="control-button" id="gameOverThemeControl" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
                        üåì
                    </div>
                </div>
                
                <div class="button-container">
                    <button id="restartButton" class="button">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
                    <button id="menuButton" class="button">–ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∑–≤—É–∫–æ–≤ -->
    <audio id="hitSound" preload="auto"></audio>
    <audio id="damageSound" preload="auto"></audio>
    <audio id="healSound" preload="auto"></audio>
    <audio id="gameOverSound" preload="auto"></audio>
    <audio id="clickSound" preload="auto"></audio>
    <audio id="timerWarningSound" preload="auto"></audio>

    <script>
        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Ç–µ–º—ã —Å–∏—Å—Ç–µ–º—ã
        function getSystemTheme() {
            return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameState = {
            score: 0,
            time: 0,
            health: 5,
            maxHealth: 5,
            gameActive: false,
            gameTimeInterval: null,
            timerInterval: null,
            timerValue: 10,
            maxTimer: 10,
            insects: [],
            insectsCount: 0,
            stats: {
                mosquitoes: 0,
                cockroaches: 0,
                flies: 0,
                bees: 0,
                ladybugs: 0,
                beetles: 0
            },
            gameAreaSize: {
                width: 0,
                height: 0
            },
            soundEnabled: true,
            theme: 'auto' // auto, dark, light
        };

        // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        let gameStats = {
            totalPoints: 0,
            bestPoints: 0,
            bestTime: 0,
            totalGames: 0
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–¥–µ—á–µ–∫ –∑–¥–æ—Ä–æ–≤—å—è
        function initHearts() {
            const heartsContainer = document.getElementById('heartsContainer');
            heartsContainer.innerHTML = '';
            
            for (let i = 0; i < gameState.maxHealth; i++) {
                const heart = document.createElement('div');
                heart.className = i < gameState.health ? 'heart' : 'heart empty';
                heart.textContent = i < gameState.health ? '‚ù§Ô∏è' : 'üñ§';
                heartsContainer.appendChild(heart);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ—Ä–¥–µ—á–µ–∫
        function updateHearts() {
            const hearts = document.querySelectorAll('.heart');
            hearts.forEach((heart, index) => {
                if (index < gameState.health) {
                    heart.textContent = '‚ù§Ô∏è';
                    heart.classList.remove('empty');
                } else {
                    heart.textContent = 'üñ§';
                    heart.classList.add('empty');
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ –∑–≤—É–∫–∞–º–∏
        function initSounds() {
            // –°–æ–∑–¥–∞–µ–º –∑–≤—É–∫–∏ —Å –ø–æ–º–æ—â—å—é Web Audio API
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // –ó–≤—É–∫ –ø–æ–ø–∞–¥–∞–Ω–∏—è
            function createHitSound() {
                if (!audioContext) return;
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.2);
            }
            
            // –ó–≤—É–∫ —É—Ä–æ–Ω–∞
            function createDamageSound() {
                if (!audioContext) return;
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(150, audioContext.currentTime + 0.3);
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            }
            
            // –ó–≤—É–∫ –ª–µ—á–µ–Ω–∏—è
            function createHealSound() {
                if (!audioContext) return;
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.15, audioContext.currentTime + 0.05);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.4);
            }
            
            // –ó–≤—É–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
            function createGameOverSound() {
                if (!audioContext) return;
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(392, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(349.23, audioContext.currentTime + 0.2);
                oscillator.frequency.setValueAtTime(293.66, audioContext.currentTime + 0.4);
                oscillator.frequency.setValueAtTime(261.63, audioContext.currentTime + 0.6);
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.05);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.8);
            }
            
            // –ó–≤—É–∫ –∫–ª–∏–∫–∞
            function createClickSound() {
                if (!audioContext) return;
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.1);
            }
            
            // –ó–≤—É–∫ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
            function createTimerWarningSound() {
                if (!audioContext) return;
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(300, audioContext.currentTime + 0.05);
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.02);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.15);
            }
            
            // –ù–∞–∑–Ω–∞—á–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏
            window.playHitSound = createHitSound;
            window.playDamageSound = createDamageSound;
            window.playHealSound = createHealSound;
            window.playGameOverSound = createGameOverSound;
            window.playClickSound = createClickSound;
            window.playTimerWarningSound = createTimerWarningSound;
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞—É–¥–∏–æ–∫–æ–Ω—Ç–µ–∫—Å—Ç
            document.addEventListener('click', function initAudioContext() {
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                document.removeEventListener('click', initAudioContext);
            }, { once: true });
        }
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞
        function playSound(soundFunction) {
            if (gameState.soundEnabled && soundFunction) {
                try {
                    soundFunction();
                } catch (e) {
                    console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:", e);
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∑–≤—É–∫–∞
        function updateAllSoundButtons() {
            const soundButtons = [
                document.getElementById('soundControl'),
                document.getElementById('menuSoundControl'),
                document.getElementById('statsSoundControl'),
                document.getElementById('gameOverSoundControl')
            ];
            
            soundButtons.forEach(button => {
                if (button) {
                    if (gameState.soundEnabled) {
                        button.textContent = 'üîä';
                        button.classList.remove('muted');
                        button.title = '–í—ã–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤';
                    } else {
                        button.textContent = 'üîá';
                        button.classList.add('muted');
                        button.title = '–í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤';
                    }
                }
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ —Ç–µ–º—ã
        function updateAllThemeButtons() {
            const themeButtons = [
                document.getElementById('themeControl'),
                document.getElementById('menuThemeControl'),
                document.getElementById('statsThemeControl'),
                document.getElementById('gameOverThemeControl')
            ];
            
            const body = document.body;
            
            themeButtons.forEach(button => {
                if (button) {
                    if (gameState.theme === 'auto') {
                        button.textContent = 'üåì';
                        button.title = '–ê–≤—Ç–æ —Ç–µ–º–∞';
                    } else if (gameState.theme === 'light') {
                        button.textContent = 'üåï';
                        button.title = '–¢–µ–º–Ω–∞—è —Ç–µ–º–∞';
                    } else {
                        button.textContent = 'üåë';
                        button.title = '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
                    }
                }
            });
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–æ–≤ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            localStorage.setItem('komarSoundEnabled', gameState.soundEnabled);
            updateAllSoundButtons();
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
        function toggleTheme() {
            const body = document.body;
            
            if (gameState.theme === 'auto') {
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É
                body.classList.add('light-theme');
                gameState.theme = 'light';
            } else if (gameState.theme === 'light') {
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Ç–µ–º–Ω—É—é —Ç–µ–º—É
                body.classList.remove('light-theme');
                gameState.theme = 'dark';
            } else {
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –∞–≤—Ç–æ —Ç–µ–º—É
                const systemTheme = getSystemTheme();
                if (systemTheme === 'light') {
                    body.classList.add('light-theme');
                } else {
                    body.classList.remove('light-theme');
                }
                gameState.theme = 'auto';
            }
            
            localStorage.setItem('komarTheme', gameState.theme);
            updateAllThemeButtons();
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ localStorage
        function loadStats() {
            const savedStats = localStorage.getItem('komarStats');
            if (savedStats) {
                gameStats = JSON.parse(savedStats);
            }
            updateStatsDisplay();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ localStorage
        function saveStats() {
            localStorage.setItem('komarStats', JSON.stringify(gameStats));
            updateStatsDisplay();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStatsDisplay() {
            document.getElementById('totalPoints').textContent = gameStats.totalPoints;
            document.getElementById('bestPoints').textContent = gameStats.bestPoints;
            document.getElementById('bestTime').textContent = gameStats.bestTime + ' —Å–µ–∫';
            document.getElementById('totalGames').textContent = gameStats.totalGames;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–≥—Ä–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function updateGameDisplay() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('time').textContent = gameState.time;
            updateHearts();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
            const timerPercent = (gameState.timerValue / gameState.maxTimer) * 100;
            const timerFill = document.getElementById('timerFill');
            const timerText = document.getElementById('timerText');
            const timerBar = document.querySelector('.timer-bar');
            
            timerFill.style.width = `${timerPercent}%`;
            timerText.textContent = Math.ceil(gameState.timerValue);
            
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ —Ç–∞–π–º–µ—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏
            if (gameState.timerValue <= 3) {
                timerFill.style.background = `linear-gradient(90deg, var(--timer-orange) 0%, var(--timer-red) 100%)`;
                if (timerBar) timerBar.classList.add('urgent-timer');
                
                // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –ø—Ä–∏ —Ç–∞–π–º–µ—Ä–µ <= 3
                if (Math.ceil(gameState.timerValue) !== Math.ceil(gameState.timerValue + 0.1)) {
                    playSound(window.playTimerWarningSound);
                }
            } else if (gameState.timerValue <= 6) {
                timerFill.style.background = `linear-gradient(90deg, var(--timer-green) 0%, var(--timer-orange) 100%)`;
                if (timerBar) timerBar.classList.remove('urgent-timer');
            } else {
                timerFill.style.background = `linear-gradient(90deg, var(--timer-green) 0%, var(--timer-green) 100%)`;
                if (timerBar) timerBar.classList.remove('urgent-timer');
            }
        }

        // –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞
        function resetTimer() {
            gameState.timerValue = gameState.maxTimer;
            updateGameDisplay();
        }

        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
        function startTimer() {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            gameState.timerInterval = setInterval(() => {
                if (gameState.gameActive) {
                    gameState.timerValue -= 0.1;
                    
                    if (gameState.timerValue <= 0) {
                        gameState.timerValue = 0;
                        endGame("–í—Ä–µ–º—è –≤—ã—à–ª–æ! –ù–µ —É—Å–ø–µ–ª–∏ —É–±–∏—Ç—å –∫–æ–º–∞—Ä–∞, –º—É—Ö—É, —Ç–∞—Ä–∞–∫–∞–Ω–∞ –∏–ª–∏ –±–æ–∂—å—é –∫–æ—Ä–æ–≤–∫—É.");
                    }
                    
                    updateGameDisplay();
                }
            }, 100);
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –∏–≥—Ä–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏
        function getGameAreaSize() {
            const gameArea = document.getElementById('gameArea');
            if (!gameArea) return { width: 0, height: 0 };
            
            const width = gameArea.clientWidth;
            const height = gameArea.clientHeight;
            
            gameState.gameAreaSize = { width, height };
            return { width, height };
        }

        // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ –¥–ª—è –Ω–∞—Å–µ–∫–æ–º–æ–≥–æ
        function calculateRotation(startX, startY, endX, endY, insectType) {
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è (–≤–µ–∫—Ç–æ—Ä)
            const dx = endX - startX;
            const dy = endY - startY;
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —É–≥–æ–ª –¥–≤–∏–∂–µ–Ω–∏—è –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö
            // Math.atan2(dy, dx) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–≥–æ–ª –æ—Ç –æ—Å–∏ X (–≤–ø—Ä–∞–≤–æ) –¥–æ –≤–µ–∫—Ç–æ—Ä–∞
            let angleRad = Math.atan2(dy, dx);
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –≥—Ä–∞–¥—É—Å—ã
            let angleDeg = angleRad * (180 / Math.PI);
            
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —É–≥–æ–ª –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞—Å–µ–∫–æ–º–æ–≥–æ
            switch(insectType) {
                case 'ü¶ü': // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–º–æ—Ç—Ä–∏—Ç –≤–ª–µ–≤–æ
                case 'üêù': // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–º–æ—Ç—Ä–∏—Ç –≤–ª–µ–≤–æ
                    // –ï—Å–ª–∏ —Å–º–æ—Ç—Ä–∏—Ç –≤–ª–µ–≤–æ (0¬∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –≤–ª–µ–≤–æ), –Ω—É–∂–Ω–æ –ø–æ–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ 180¬∞,
                    // —á—Ç–æ–±—ã –æ–Ω —Å–º–æ—Ç—Ä–µ–ª –≤–ø—Ä–∞–≤–æ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
                    angleDeg += 180;
                    break;
                case 'ü™≥': // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–º–æ—Ç—Ä–∏—Ç –≤–≤–µ—Ä—Ö
                case 'ü™∞': // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–º–æ—Ç—Ä–∏—Ç –≤–≤–µ—Ä—Ö
                case 'üêû': // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–º–æ—Ç—Ä–∏—Ç –≤–≤–µ—Ä—Ö
                case 'ü™≤': // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–º–æ—Ç—Ä–∏—Ç –≤–≤–µ—Ä—Ö
                    // –ï—Å–ª–∏ —Å–º–æ—Ç—Ä–∏—Ç –≤–≤–µ—Ä—Ö (0¬∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –≤–≤–µ—Ä—Ö), –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å 90¬∞,
                    // —Ç–∞–∫ –∫–∞–∫ –≤–µ–∫—Ç–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç –æ—Å–∏ X (–≤–ø—Ä–∞–≤–æ)
                    angleDeg += 90;
                    break;
            }
            
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —É–≥–æ–ª –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0-360
            while (angleDeg < 0) angleDeg += 360;
            while (angleDeg >= 360) angleDeg -= 360;
            
            return angleDeg;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—Å–µ–∫–æ–º–æ–≥–æ
        function createInsect(type) {
            const gameArea = document.getElementById('gameArea');
            
            if (!gameArea || !gameState.gameActive) return;
            
            const { width: areaWidth, height: areaHeight } = getGameAreaSize();
            
            if (areaWidth < 50 || areaHeight < 50) return;
            
            const insect = document.createElement('div');
            insect.className = 'insect';
            insect.textContent = type;
            
            // –°–ª—É—á–∞–π–Ω—ã–π —Ä–∞–∑–º–µ—Ä
            const sizeVariation = 0.8 + Math.random() * 0.25;
            const insectSize = 38 * sizeVariation;
            insect.style.fontSize = `${insectSize}px`;
            
            // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
            const startSide = Math.floor(Math.random() * 4);
            let startX, startY;
            
            const offset = Math.max(40, Math.min(areaWidth, areaHeight) * 0.04);
            
            switch(startSide) {
                case 0: startX = Math.random() * areaWidth; startY = -offset; break;
                case 1: startX = areaWidth + offset; startY = Math.random() * areaHeight; break;
                case 2: startX = Math.random() * areaWidth; startY = areaHeight + offset; break;
                case 3: startX = -offset; startY = Math.random() * areaHeight; break;
            }
            
            insect.style.left = `${startX}px`;
            insect.style.top = `${startY}px`;
            
            // –ö–æ–Ω–µ—á–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
            let endX, endY;
            
            switch(startSide) {
                case 0: endX = Math.random() * areaWidth; endY = areaHeight + offset; break;
                case 1: endX = -offset; endY = Math.random() * areaHeight; break;
                case 2: endX = Math.random() * areaWidth; endY = -offset; break;
                case 3: endX = areaWidth + offset; endY = Math.random() * areaHeight; break;
            }
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞
            const rotationAngle = calculateRotation(startX, startY, endX, endY, type);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ inline —Å—Ç–∏–ª—å
            insect.style.transform = `translate(-50%, -50%) rotate(${rotationAngle}deg)`;
            
            // –°–∫–æ—Ä–æ—Å—Ç—å
            let speedModifier = 1;
            if (type === 'ü™∞') speedModifier = 1.6;
            else if (type === 'ü™≥') speedModifier = 0.8;
            else if (type === 'ü™≤') speedModifier = 1.2;
            else if (type === 'üêù') speedModifier = 1.4;
            else if (type === 'üêû') speedModifier = 0.7;
            
            const sizeSpeedFactor = 1 / sizeVariation;
            speedModifier *= sizeSpeedFactor;
            
            // –í—Ä–µ–º—è –ø–æ–ª–µ—Ç–∞
            const baseSpeed = 3500 + Math.random() * 1500;
            const timeModifier = Math.max(1, gameState.time / 50);
            const flightTime = (baseSpeed / timeModifier) / speedModifier;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è
            const startTime = Date.now();
            
            function animateInsect() {
                if (!gameState.gameActive || !insect.parentNode) return;
                
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / flightTime, 1);
                
                const currentX = startX + (endX - startX) * progress;
                const currentY = startY + (endY - startY) * progress;
                
                insect.style.left = `${currentX}px`;
                insect.style.top = `${currentY}px`;
                
                if (progress < 1) {
                    requestAnimationFrame(animateInsect);
                } else {
                    if (insect.parentNode) {
                        insect.remove();
                        const index = gameState.insects.indexOf(insect);
                        if (index > -1) gameState.insects.splice(index, 1);
                        gameState.insectsCount--;
                    }
                }
            }
            
            requestAnimationFrame(animateInsect);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
            insect.addEventListener('click', () => handleInsectClick(insect, type));
            insect.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handleInsectClick(insect, type);
            }, { passive: false });
            
            gameArea.appendChild(insect);
            gameState.insects.push(insect);
            gameState.insectsCount++;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            switch(type) {
                case 'ü¶ü': gameState.stats.mosquitoes++; break;
                case 'ü™≥': gameState.stats.cockroaches++; break;
                case 'ü™∞': gameState.stats.flies++; break;
                case 'üêù': gameState.stats.bees++; break;
                case 'üêû': gameState.stats.ladybugs++; break;
                case 'ü™≤': gameState.stats.beetles++; break;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –Ω–∞—Å–µ–∫–æ–º–æ–º—É
        function handleInsectClick(insect, type) {
            if (!gameState.gameActive) return;
            
            playSound(window.playHitSound);
            
            // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–ø–∞–¥–∞–Ω–∏—è
            const hitEffect = document.createElement('div');
            hitEffect.className = 'hit-effect';
            hitEffect.textContent = 'üí•';
            hitEffect.style.left = insect.style.left;
            hitEffect.style.top = insect.style.top;
            document.getElementById('gameArea').appendChild(hitEffect);
            
            setTimeout(() => {
                if (hitEffect.parentNode) hitEffect.remove();
            }, 500);
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –Ω–∞—Å–µ–∫–æ–º–æ–≥–æ
            if (insect.parentNode) {
                insect.remove();
                const index = gameState.insects.indexOf(insect);
                if (index > -1) gameState.insects.splice(index, 1);
                gameState.insectsCount--;
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ —Ç–∏–ø—É
            switch(type) {
                case 'ü¶ü':
                case 'ü™≥':
                case 'ü™∞':
                    gameState.score++;
                    resetTimer();
                    updateGameDisplay();
                    break;
                    
                case 'üêù':
                case 'ü™≤':
                    gameState.health--;
                    playSound(window.playDamageSound);
                    updateGameDisplay();
                    if (gameState.health <= 0) {
                        endGame("–ó–¥–æ—Ä–æ–≤—å–µ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å!");
                    }
                    break;
                    
                case 'üêû':
                    if (gameState.health < gameState.maxHealth) {
                        gameState.health++;
                        playSound(window.playHealSound);
                    }
                    resetTimer();
                    updateGameDisplay();
                    break;
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞—Å–µ–∫–æ–º—ã—Ö
        function generateInsects() {
            if (!gameState.gameActive) return;
            
            const { width, height } = getGameAreaSize();
            if (width < 100 || height < 100) return;
            
            const baseCount = 5;
            const timeBonus = Math.floor(gameState.time / 30);
            const screenFactor = Math.min(width * height / (400 * 800), 2.2);
            const maxInsects = Math.min(baseCount + timeBonus, Math.floor(20 * screenFactor));
            
            if (gameState.insectsCount < maxInsects) {
                const insectTypes = [
                    'ü¶ü', 'ü¶ü', 'ü¶ü', 'ü¶ü', 'ü¶ü',
                    'ü™≥', 'ü™≥', 'ü™≥', 'ü™≥',
                    'ü™∞', 'ü™∞', 'ü™∞', 'ü™∞',
                    'üêù', 'üêù', 'üêù',
                    'üêû', 'üêû', 'üêû',
                    'ü™≤', 'ü™≤', 'ü™≤'
                ];
                const randomType = insectTypes[Math.floor(Math.random() * insectTypes.length)];
                createInsect(randomType);
            }
            
            const baseInterval = 800;
            const timePenalty = Math.min(gameState.time * 3, 200);
            const screenSizePenalty = width < 300 ? 200 : 0;
            const nextGeneration = Math.max(baseInterval - timePenalty + screenSizePenalty, 500);
            
            setTimeout(generateInsects, nextGeneration);
        }

        // –¢–∞–π–º–µ—Ä –∏–≥—Ä—ã
        function startGameTimer() {
            gameState.gameTimeInterval = setInterval(() => {
                if (gameState.gameActive) {
                    gameState.time++;
                    updateGameDisplay();
                }
            }, 1000);
        }

        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
        function startGame() {
            gameState.score = 0;
            gameState.time = 0;
            gameState.health = 5;
            gameState.timerValue = 10;
            gameState.gameActive = true;
            gameState.insects = [];
            gameState.insectsCount = 0;
            gameState.stats = { 
                mosquitoes: 0, 
                cockroaches: 0, 
                flies: 0, 
                bees: 0, 
                ladybugs: 0, 
                beetles: 0 
            };
            
            const gameArea = document.getElementById('gameArea');
            if (gameArea) {
                gameArea.innerHTML = '<div class="game-area-border"></div>';
            }
            
            getGameAreaSize();
            updateGameDisplay();
            initHearts();
            
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('statsScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            if (gameState.gameTimeInterval) clearInterval(gameState.gameTimeInterval);
            if (gameState.timerInterval) clearInterval(gameState.timerInterval);
            
            startGameTimer();
            startTimer();
            
            setTimeout(() => {
                generateInsects();
            }, 300);
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –Ω–∞—Å–µ–∫–æ–º—ã—Ö
        function clearAllInsects() {
            const gameArea = document.getElementById('gameArea');
            if (gameArea) {
                gameArea.innerHTML = '<div class="game-area-border"></div>';
            }
            gameState.insects = [];
            gameState.insectsCount = 0;
        }

        // –û–∫–æ–Ω—á–∞–Ω–∏–µ –∏–≥—Ä—ã
        function endGame(reason = "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞") {
            gameState.gameActive = false;
            
            if (gameState.gameTimeInterval) clearInterval(gameState.gameTimeInterval);
            if (gameState.timerInterval) clearInterval(gameState.timerInterval);
            
            playSound(window.playGameOverSound);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            gameStats.totalGames++;
            gameStats.totalPoints += gameState.score;
            
            if (gameState.score > gameStats.bestPoints) {
                gameStats.bestPoints = gameState.score;
            }
            
            if (gameState.time > gameStats.bestTime) {
                gameStats.bestTime = gameState.time;
            }
            
            saveStats();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('finalTime').textContent = gameState.time;
            document.getElementById('endReason').textContent = reason;
            document.getElementById('endMosquitoes').textContent = gameState.stats.mosquitoes;
            document.getElementById('endCockroaches').textContent = gameState.stats.cockroaches;
            document.getElementById('endFlies').textContent = gameState.stats.flies;
            document.getElementById('endLadybugs').textContent = gameState.stats.ladybugs;
            document.getElementById('endBees').textContent = gameState.stats.bees;
            document.getElementById('endBeetles').textContent = gameState.stats.beetles;
            
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.remove('hidden');
            
            clearAllInsects();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function initEventListeners() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            document.getElementById('startButton').addEventListener('click', () => {
                playSound(window.playClickSound);
                startGame();
            });
            
            document.getElementById('restartButton').addEventListener('click', () => {
                playSound(window.playClickSound);
                startGame();
            });
            
            document.getElementById('showStatsButton').addEventListener('click', () => {
                playSound(window.playClickSound);
                document.getElementById('startScreen').classList.add('hidden');
                document.getElementById('statsScreen').classList.remove('hidden');
            });
            
            document.getElementById('backToMenuButton').addEventListener('click', () => {
                playSound(window.playClickSound);
                document.getElementById('statsScreen').classList.add('hidden');
                document.getElementById('startScreen').classList.remove('hidden');
            });
            
            document.getElementById('menuButton').addEventListener('click', () => {
                playSound(window.playClickSound);
                document.getElementById('gameOverScreen').classList.add('hidden');
                document.getElementById('startScreen').classList.remove('hidden');
                clearAllInsects();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤—É–∫–æ–º
            const soundButtons = [
                document.getElementById('soundControl'),
                document.getElementById('menuSoundControl'),
                document.getElementById('statsSoundControl'),
                document.getElementById('gameOverSoundControl')
            ];
            
            soundButtons.forEach(button => {
                if (button) {
                    button.addEventListener('click', () => {
                        playSound(window.playClickSound);
                        toggleSound();
                    });
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–º–æ–π
            const themeButtons = [
                document.getElementById('themeControl'),
                document.getElementById('menuThemeControl'),
                document.getElementById('statsThemeControl'),
                document.getElementById('gameOverThemeControl')
            ];
            
            themeButtons.forEach(button => {
                if (button) {
                    button.addEventListener('click', () => {
                        playSound(window.playClickSound);
                        toggleTheme();
                    });
                }
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                getGameAreaSize();
                if (gameState.gameActive) {
                    clearAllInsects();
                    setTimeout(generateInsects, 300);
                }
            }, 200);
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        window.addEventListener('DOMContentLoaded', () => {
            loadStats();
            getGameAreaSize();
            initSounds();
            initEventListeners();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            const savedSound = localStorage.getItem('komarSoundEnabled');
            const savedTheme = localStorage.getItem('komarTheme');
            
            if (savedSound !== null) gameState.soundEnabled = savedSound === 'true';
            if (savedTheme !== null) gameState.theme = savedTheme;
            
            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã
            const body = document.body;
            
            if (gameState.theme === 'auto') {
                const systemTheme = getSystemTheme();
                if (systemTheme === 'light') {
                    body.classList.add('light-theme');
                }
            } else if (gameState.theme === 'light') {
                body.classList.add('light-theme');
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            updateAllSoundButtons();
            updateAllThemeButtons();
            
            if ('ontouchstart' in window) {
                document.body.style.cursor = 'pointer';
            }
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
    </script>
</body>
</html>
