<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>–ö–û–ú–ê–† - –ò–≥—Ä–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-overlay: rgba(0, 0, 0, 0.95);
            --bg-surface: rgba(255, 255, 255, 0.08);
            --bg-surface-light: rgba(255, 255, 255, 0.1);
            --text-primary: #fff;
            --text-secondary: #b0b0b0;
            --text-accent: #ff9800;
            --border-color: rgba(255, 255, 255, 0.1);
            --health-color: #00c853;
            --timer-green: #4CAF50;
            --timer-orange: #FF9800;
            --timer-red: #F44336;
            --button-bg: #ff9800;
            --button-text: #000;
            --button-hover: #ffb74d;
            --game-area-bg: rgba(0, 0, 0, 0.15);
            --shadow-color: rgba(0, 0, 0, 0.5);
            --inset-shadow: rgba(255, 255, 255, 0.05);
        }
        
        /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
        @media (prefers-color-scheme: light) {
            :root {
                --bg-primary: #f5f5f5;
                --bg-secondary: #e8e8e8;
                --bg-overlay: rgba(255, 255, 255, 0.95);
                --bg-surface: rgba(0, 0, 0, 0.06);
                --bg-surface-light: rgba(0, 0, 0, 0.08);
                --text-primary: #1a1a1a;
                --text-secondary: #555;
                --text-accent: #ff6d00;
                --border-color: rgba(0, 0, 0, 0.15);
                --health-color: #00c853;
                --timer-green: #388e3c;
                --timer-orange: #f57c00;
                --timer-red: #d32f2f;
                --button-bg: #ff6d00;
                --button-text: #fff;
                --button-hover: #ff8f00;
                --game-area-bg: rgba(0, 0, 0, 0.05);
                --shadow-color: rgba(0, 0, 0, 0.1);
                --inset-shadow: rgba(0, 0, 0, 0.05);
            }
            
            .insect {
                filter: drop-shadow(0 0 3px rgba(0, 0, 0, 0.3));
            }
            
            .hit-effect {
                text-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
            }
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.3s ease, color 0.3s ease;
        }
        
        .game-wrapper {
            width: 100%;
            height: 100%;
            max-width: 800px;
            max-height: 1200px;
            position: relative;
            overflow: hidden;
        }
        
        @media (max-width: 768px) {
            .game-wrapper {
                max-width: 100%;
                max-height: 100%;
            }
        }
        
        .game-container {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            padding: 8px 12px;
            background-color: var(--bg-overlay);
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            z-index: 10;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }
        
        .stats {
            display: flex;
            flex-direction: column;
            gap: 3px;
            min-width: 140px;
        }
        
        .stat-item {
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--text-primary);
        }
        
        .stat-value {
            font-weight: bold;
            color: var(--text-accent);
            font-size: 14px;
        }
        
        .health-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .health-bar {
            width: 80px;
            height: 8px;
            background-color: var(--bg-surface-light);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .health-fill {
            height: 100%;
            background-color: var(--health-color);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .timer-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .timer-bar {
            width: 80px;
            height: 8px;
            background-color: var(--bg-surface-light);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--timer-green) 0%, var(--timer-orange) 50%, var(--timer-red) 100%);
            border-radius: 4px;
            width: 100%;
            transition: width 0.1s linear;
        }
        
        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
            font-weight: bold;
            color: var(--text-primary);
            text-shadow: 0 0 2px var(--shadow-color);
            z-index: 2;
        }
        
        .game-area {
            flex: 1;
            position: relative;
            overflow: hidden;
            background-color: var(--game-area-bg);
            width: 100%;
            height: 100%;
        }
        
        .game-area-border {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            box-shadow: inset 0 0 0 1px var(--inset-shadow);
        }
        
        .insect {
            position: absolute;
            font-size: 48px;
            cursor: pointer;
            transition: transform 0.1s;
            z-index: 2;
            text-shadow: 0 0 12px var(--shadow-color);
            pointer-events: auto;
            transform: translate(-50%, -50%);
            will-change: transform;
            filter: drop-shadow(0 0 5px var(--shadow-color));
        }
        
        .insect:hover {
            transform: translate(-50%, -50%) scale(1.15);
        }
        
        .insect.mosquito {
            animation: mosquitoFloat 2s infinite alternate ease-in-out;
        }
        
        @keyframes mosquitoFloat {
            0% { transform: translate(-50%, -50%) scale(1); }
            100% { transform: translate(-50%, -50%) scale(1.05); }
        }
        
        .hit-effect {
            position: absolute;
            font-size: 60px;
            pointer-events: none;
            animation: hitAnim 0.5s forwards;
            z-index: 3;
            transform: translate(-50%, -50%);
        }
        
        @keyframes hitAnim {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(2.5); opacity: 0; }
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: var(--bg-overlay);
            z-index: 20;
            padding: 15px;
            text-align: center;
            overflow-y: auto;
            transition: background 0.3s ease;
        }
        
        .title {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--text-accent);
            text-shadow: 0 0 8px color-mix(in srgb, var(--text-accent) 50%, transparent);
        }
        
        .game-rules {
            background-color: color-mix(in srgb, var(--text-accent) 8%, transparent);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            max-width: 420px;
            border: 1px solid color-mix(in srgb, var(--text-accent) 15%, transparent);
        }
        
        .rules-title {
            font-size: 16px;
            color: var(--text-accent);
            margin-bottom: 8px;
        }
        
        .rules-list {
            text-align: left;
            padding-left: 15px;
        }
        
        .rules-list li {
            margin-bottom: 6px;
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.3;
        }
        
        .emoji-info {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
            max-width: 420px;
            padding: 0 5px;
        }
        
        .emoji-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 28px;
            width: 70px;
        }
        
        .emoji-desc {
            font-size: 11px;
            margin-top: 5px;
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.2;
        }
        
        .button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
        }
        
        .button {
            background-color: var(--button-bg);
            color: var(--button-text);
            border: none;
            border-radius: 25px;
            padding: 12px 24px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 10px color-mix(in srgb, var(--button-bg) 20%, transparent);
            min-width: 180px;
        }
        
        .button:hover {
            background-color: var(--button-hover);
            transform: translateY(-2px);
        }
        
        .button:active {
            transform: translateY(1px);
        }
        
        .stats-table {
            background-color: var(--bg-surface);
            border-radius: 10px;
            padding: 15px;
            margin: 10px;
            width: 90%;
            max-width: 400px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
        }
        
        .stats-title {
            font-size: 20px;
            margin-bottom: 12px;
            color: var(--text-accent);
        }
        
        .stats-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .stats-item:last-child {
            border-bottom: none;
        }
        
        .score-value {
            font-weight: bold;
            color: var(--text-accent);
        }
        
        .game-over {
            color: var(--timer-red);
            font-size: 30px;
            margin-bottom: 12px;
        }
        
        .final-score {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        
        .hidden {
            display: none !important;
        }
        
        .urgent-timer {
            animation: timerPulse 0.8s infinite alternate;
        }
        
        @keyframes timerPulse {
            0% { box-shadow: 0 0 3px color-mix(in srgb, var(--timer-red) 40%, transparent); }
            100% { box-shadow: 0 0 8px color-mix(in srgb, var(--timer-red) 70%, transparent); }
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–µ–º—ã (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏) */
        .theme-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: var(--text-accent);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--button-text);
            opacity: 0.7;
        }
        
        @media (max-height: 600px) {
            .title {
                font-size: 28px;
                margin-bottom: 10px;
            }
            
            .game-rules {
                padding: 10px;
                margin-bottom: 15px;
                max-width: 380px;
            }
            
            .rules-title {
                font-size: 14px;
            }
            
            .rules-list li {
                font-size: 12px;
                margin-bottom: 4px;
            }
            
            .emoji-info {
                margin-bottom: 15px;
                gap: 8px;
            }
            
            .emoji-item {
                width: 60px;
                font-size: 24px;
            }
            
            .button {
                padding: 10px 20px;
                font-size: 14px;
                min-width: 160px;
            }
            
            .insect {
                font-size: 42px;
            }
        }
        
        @media (max-width: 380px) {
            .title {
                font-size: 24px;
            }
            
            .game-rules {
                max-width: 340px;
            }
            
            .emoji-item {
                width: 55px;
                font-size: 22px;
            }
            
            .button {
                padding: 8px 16px;
                font-size: 13px;
                min-width: 140px;
            }
            
            .header {
                padding: 6px 8px;
            }
            
            .stat-item {
                font-size: 11px;
            }
            
            .stat-value {
                font-size: 12px;
            }
            
            .health-bar, .timer-bar {
                width: 70px;
            }
            
            .insect {
                font-size: 40px;
            }
        }
        
        @media (orientation: landscape) and (max-height: 500px) {
            .title {
                font-size: 24px;
                margin-bottom: 8px;
            }
            
            .game-rules {
                padding: 8px;
                margin-bottom: 10px;
                max-width: 90%;
            }
            
            .rules-list li {
                font-size: 11px;
            }
            
            .emoji-info {
                margin-bottom: 10px;
                gap: 6px;
            }
            
            .button {
                padding: 6px 12px;
                font-size: 12px;
                min-width: 120px;
                margin: 2px;
            }
            
            .stats-table {
                padding: 10px;
                margin: 8px;
            }
            
            .insect {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–µ–º—ã (–º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏) -->
        <div class="theme-indicator" id="themeIndicator"></div>
        
        <div class="game-container">
            <!-- –≠–∫—Ä–∞–Ω –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã -->
            <div id="startScreen" class="screen">
                <h1 class="title">–ö–û–ú–ê–†</h1>
                
                <div class="game-rules">
                    <div class="rules-title">–ü—Ä–∞–≤–∏–ª–∞:</div>
                    <ul class="rules-list">
                        <li>–£–±–∏–≤–∞–π—Ç–µ –∫–æ–º–∞—Ä–æ–≤ ü¶ü —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ—á–∫–∏</li>
                        <li>–ò–∑–±–µ–≥–∞–π—Ç–µ –ø—á—ë–ª üêù - –æ–Ω–∏ –æ—Ç–Ω–∏–º–∞—é—Ç –∑–¥–æ—Ä–æ–≤—å–µ</li>
                        <li>–°–æ–±–∏—Ä–∞–π—Ç–µ –±–æ–∂—å–∏—Ö –∫–æ—Ä–æ–≤–æ–∫ üêû –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è</li>
                        <li>–ú—É—Ö–∏ ü™∞ –ø—Ä–æ—Å—Ç–æ –ª–µ—Ç–∞—é—Ç –∏ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –∏–≥—Ä—É</li>
                        <li>–£ –≤–∞—Å –µ—Å—Ç—å 10 —Å–µ–∫—É–Ω–¥ —á—Ç–æ–±—ã —É–±–∏—Ç—å –∫–æ–º–∞—Ä–∞!</li>
                        <li>–ö–∞–∂–¥—ã–π —É–±–∏—Ç—ã–π –∫–æ–º–∞—Ä —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ç–∞–π–º–µ—Ä –Ω–∞ 10 —Å–µ–∫—É–Ω–¥</li>
                        <li>–ï—Å–ª–∏ —Ç–∞–π–º–µ—Ä –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç –Ω—É–ª—è - –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</li>
                    </ul>
                </div>
                
                <div class="emoji-info">
                    <div class="emoji-item">
                        <div>ü¶ü</div>
                        <div class="emoji-desc">–ö–æ–º–∞—Ä—ã<br>+1 –æ—á–∫–æ<br>–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ç–∞–π–º–µ—Ä</div>
                    </div>
                    <div class="emoji-item">
                        <div>üêù</div>
                        <div class="emoji-desc">–ü—á—ë–ª—ã<br>-1 –∑–¥–æ—Ä–æ–≤—å–µ</div>
                    </div>
                    <div class="emoji-item">
                        <div>üêû</div>
                        <div class="emoji-desc">–ë–æ–∂—å—è –∫–æ—Ä–æ–≤–∫–∞<br>+1 –∑–¥–æ—Ä–æ–≤—å–µ</div>
                    </div>
                    <div class="emoji-item">
                        <div>ü™∞</div>
                        <div class="emoji-desc">–ú—É—Ö–∏<br>–±–µ–∑ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π</div>
                    </div>
                </div>
                
                <div class="button-container">
                    <button id="startButton" class="button">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
                    <button id="showStatsButton" class="button">–°–¢–ê–¢–ò–°–¢–ò–ö–ê</button>
                </div>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
            <div id="statsScreen" class="screen hidden">
                <h2 class="stats-title">–°–¢–ê–¢–ò–°–¢–ò–ö–ê</h2>
                <div class="stats-table">
                    <div class="stats-item">
                        <span>–í—Å–µ–≥–æ —É–±–∏—Ç–æ –∫–æ–º–∞—Ä–æ–≤:</span>
                        <span id="totalMosquitoes" class="score-value">0</span>
                    </div>
                    <div class="stats-item">
                        <span>–†–µ–∫–æ—Ä–¥ —É–±–∏—Ç—ã—Ö –∑–∞ –∏–≥—Ä—É:</span>
                        <span id="bestMosquitoes" class="score-value">0</span>
                    </div>
                    <div class="stats-item">
                        <span>–õ—É—á—à–µ–µ –≤—Ä–µ–º—è –≤—ã–∂–∏–≤–∞–Ω–∏—è:</span>
                        <span id="bestTime" class="score-value">0 —Å–µ–∫</span>
                    </div>
                    <div class="stats-item">
                        <span>–í—Å–µ–≥–æ –∏–≥—Ä:</span>
                        <span id="totalGames" class="score-value">0</span>
                    </div>
                </div>
                <button id="backToMenuButton" class="button">–ù–ê–ó–ê–î –í –ú–ï–ù–Æ</button>
            </div>
            
            <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
            <div id="gameScreen" class="screen hidden">
                <div class="header">
                    <div class="stats">
                        <div class="stat-item">–ö–æ–º–∞—Ä—ã: <span id="score" class="stat-value">0</span></div>
                        <div class="stat-item">–í—Ä–µ–º—è: <span id="time" class="stat-value">0</span> —Å–µ–∫</div>
                        <div class="timer-container">
                            <div class="stat-item">–¢–∞–π–º–µ—Ä:</div>
                            <div class="timer-bar">
                                <div id="timerFill" class="timer-fill" style="width: 100%"></div>
                                <div id="timerText" class="timer-text">10</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="health-container">
                        <div class="stat-item">–ó–¥–æ—Ä–æ–≤—å–µ:</div>
                        <div class="health-bar">
                            <div id="healthFill" class="health-fill" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="game-area" id="gameArea">
                    <div class="game-area-border"></div>
                </div>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã -->
            <div id="gameOverScreen" class="screen hidden">
                <h2 class="game-over">–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</h2>
                <div class="final-score">–£–±–∏—Ç–æ –∫–æ–º–∞—Ä–æ–≤: <span id="finalScore">0</span></div>
                <div class="final-score">–í—Ä–µ–º—è –≤—ã–∂–∏–≤–∞–Ω–∏—è: <span id="finalTime">0</span> —Å–µ–∫</div>
                <div class="final-score" id="endReason">–¢–∞–π–º–µ—Ä –∏—Å—Ç—ë–∫</div>
                
                <div class="stats-table">
                    <div class="stats-item">
                        <span>–ö–æ–º–∞—Ä–æ–≤ —É–±–∏—Ç–æ:</span>
                        <span id="endMosquitoes" class="score-value">0</span>
                    </div>
                    <div class="stats-item">
                        <span>–ü—á—ë–ª –≤—Å—Ç—Ä–µ—á–µ–Ω–æ:</span>
                        <span id="endBees" class="score-value">0</span>
                    </div>
                    <div class="stats-item">
                        <span>–ë–æ–∂—å–∏—Ö –∫–æ—Ä–æ–≤–æ–∫ —Å–æ–±—Ä–∞–Ω–æ:</span>
                        <span id="endLadybugs" class="scoreValue">0</span>
                    </div>
                    <div class="stats-item">
                        <span>–ú—É—Ö —É–≤–∏–¥–µ–ª–∏:</span>
                        <span id="endFlies" class="scoreValue">0</span>
                    </div>
                </div>
                
                <div class="button-container">
                    <button id="restartButton" class="button">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
                    <button id="menuButton" class="button">–ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Ç–µ–º—ã —Å–∏—Å—Ç–µ–º—ã
        function getSystemTheme() {
            return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Ç–µ–º—ã (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
        function updateThemeIndicator() {
            const theme = getSystemTheme();
            const indicator = document.getElementById('themeIndicator');
            if (indicator) {
                indicator.title = `–¢–µ–º–∞ —Å–∏—Å—Ç–µ–º—ã: ${theme === 'dark' ? '–¢—ë–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è'}`;
                indicator.textContent = theme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
            }
        }
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameState = {
            score: 0,
            time: 0,
            health: 5,
            maxHealth: 5,
            gameActive: false,
            gameTimeInterval: null,
            timerInterval: null,
            timerValue: 10,
            maxTimer: 10,
            insects: [],
            insectsCount: 0,
            stats: {
                mosquitoes: 0,
                bees: 0,
                ladybugs: 0,
                flies: 0
            },
            gameAreaSize: {
                width: 0,
                height: 0
            }
        };

        // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        let gameStats = {
            totalMosquitoes: 0,
            bestMosquitoes: 0,
            bestTime: 0,
            totalGames: 0
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ localStorage
        function loadStats() {
            const savedStats = localStorage.getItem('komarStats');
            if (savedStats) {
                gameStats = JSON.parse(savedStats);
            }
            updateStatsDisplay();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ localStorage
        function saveStats() {
            localStorage.setItem('komarStats', JSON.stringify(gameStats));
            updateStatsDisplay();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStatsDisplay() {
            document.getElementById('totalMosquitoes').textContent = gameStats.totalMosquitoes;
            document.getElementById('bestMosquitoes').textContent = gameStats.bestMosquitoes;
            document.getElementById('bestTime').textContent = gameStats.bestTime + ' —Å–µ–∫';
            document.getElementById('totalGames').textContent = gameStats.totalGames;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–≥—Ä–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function updateGameDisplay() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('time').textContent = gameState.time;
            const healthPercent = (gameState.health / gameState.maxHealth) * 100;
            document.getElementById('healthFill').style.width = `${healthPercent}%`;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
            const timerPercent = (gameState.timerValue / gameState.maxTimer) * 100;
            const timerFill = document.getElementById('timerFill');
            const timerText = document.getElementById('timerText');
            const timerBar = document.querySelector('.timer-bar');
            
            timerFill.style.width = `${timerPercent}%`;
            timerText.textContent = Math.ceil(gameState.timerValue);
            
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ —Ç–∞–π–º–µ—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏
            const theme = getSystemTheme();
            if (gameState.timerValue <= 3) {
                timerFill.style.background = `linear-gradient(90deg, var(--timer-orange) 0%, var(--timer-red) 100%)`;
                if (timerBar) timerBar.classList.add('urgent-timer');
            } else if (gameState.timerValue <= 6) {
                timerFill.style.background = `linear-gradient(90deg, var(--timer-green) 0%, var(--timer-orange) 100%)`;
                if (timerBar) timerBar.classList.remove('urgent-timer');
            } else {
                timerFill.style.background = `linear-gradient(90deg, var(--timer-green) 0%, var(--timer-green) 100%)`;
                if (timerBar) timerBar.classList.remove('urgent-timer');
            }
        }

        // –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞
        function resetTimer() {
            gameState.timerValue = gameState.maxTimer;
            updateGameDisplay();
        }

        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
        function startTimer() {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            gameState.timerInterval = setInterval(() => {
                if (gameState.gameActive) {
                    gameState.timerValue -= 0.1; // –£–º–µ–Ω—å—à–∞–µ–º –∫–∞–∂–¥—ã–µ 100 –º—Å –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
                    
                    if (gameState.timerValue <= 0) {
                        gameState.timerValue = 0;
                        endGame("–í—Ä–µ–º—è –≤—ã—à–ª–æ! –ù–µ —É—Å–ø–µ–ª–∏ —É–±–∏—Ç—å –∫–æ–º–∞—Ä–∞.");
                    }
                    
                    updateGameDisplay();
                }
            }, 100);
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –∏–≥—Ä–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏
        function getGameAreaSize() {
            const gameArea = document.getElementById('gameArea');
            if (!gameArea) return { width: 0, height: 0 };
            
            const width = gameArea.clientWidth;
            const height = gameArea.clientHeight;
            
            gameState.gameAreaSize = { width, height };
            return { width, height };
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—Å–µ–∫–æ–º–æ–≥–æ
        function createInsect(type) {
            const gameArea = document.getElementById('gameArea');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∏–≥—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞
            if (!gameArea || !gameState.gameActive) return;
            
            // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∏–≥—Ä–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏
            const { width: areaWidth, height: areaHeight } = getGameAreaSize();
            
            // –ï—Å–ª–∏ –æ–±–ª–∞—Å—Ç—å —Å–ª–∏—à–∫–æ–º –º–∞–ª–∞, –Ω–µ —Å–æ–∑–¥–∞–µ–º –Ω–∞—Å–µ–∫–æ–º—ã—Ö
            if (areaWidth < 50 || areaHeight < 50) return;
            
            const insect = document.createElement('div');
            insect.className = 'insect';
            insect.textContent = type;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∫–æ–º–∞—Ä–æ–≤ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
            if (type === 'ü¶ü') {
                insect.classList.add('mosquito');
            }
            
            // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (—Å–ª—É—á–∞–π–Ω—ã–π –∫—Ä–∞–π —ç–∫—Ä–∞–Ω–∞)
            const startSide = Math.floor(Math.random() * 4); // 0: –≤–µ—Ä—Ö, 1: –ø—Ä–∞–≤–æ, 2: –Ω–∏–∑, 3: –ª–µ–≤–æ
            let startX, startY;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç –∫—Ä–∞—è (–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞)
            const offset = Math.max(50, Math.min(areaWidth, areaHeight) * 0.05); // 5% –æ—Ç –º–µ–Ω—å—à–µ–π —Å—Ç–æ—Ä–æ–Ω—ã, –Ω–æ –Ω–µ –º–µ–Ω—å—à–µ 50px
            
            switch(startSide) {
                case 0: // –≤–µ—Ä—Ö
                    startX = Math.random() * areaWidth;
                    startY = -offset;
                    break;
                case 1: // –ø—Ä–∞–≤–æ
                    startX = areaWidth + offset;
                    startY = Math.random() * areaHeight;
                    break;
                case 2: // –Ω–∏–∑
                    startX = Math.random() * areaWidth;
                    startY = areaHeight + offset;
                    break;
                case 3: // –ª–µ–≤–æ
                    startX = -offset;
                    startY = Math.random() * areaHeight;
                    break;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
            insect.style.left = `${startX}px`;
            insect.style.top = `${startY}px`;
            
            // –ö–æ–Ω–µ—á–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (–ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–π –∫—Ä–∞–π)
            let endX, endY;
            
            switch(startSide) {
                case 0: // –Ω–∞—á–∞–ª–∏ —Å–≤–µ—Ä—Ö—É, –ª–µ—Ç–∏–º –≤–Ω–∏–∑
                    endX = Math.random() * areaWidth;
                    endY = areaHeight + offset;
                    break;
                case 1: // –Ω–∞—á–∞–ª–∏ —Å–ø—Ä–∞–≤–∞, –ª–µ—Ç–∏–º –≤–ª–µ–≤–æ
                    endX = -offset;
                    endY = Math.random() * areaHeight;
                    break;
                case 2: // –Ω–∞—á–∞–ª–∏ —Å–Ω–∏–∑—É, –ª–µ—Ç–∏–º –≤–≤–µ—Ä—Ö
                    endX = Math.random() * areaWidth;
                    endY = -offset;
                    break;
                case 3: // –Ω–∞—á–∞–ª–∏ —Å–ª–µ–≤–∞, –ª–µ—Ç–∏–º –≤–ø—Ä–∞–≤–æ
                    endX = areaWidth + offset;
                    endY = Math.random() * areaHeight;
                    break;
            }
            
            // –î–ª—è –º—É—Ö - —É–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
            let speedModifier = 1;
            if (type === 'ü™∞') {
                speedModifier = 1.5; // –ú—É—Ö–∏ –Ω–∞ 50% –±—ã—Å—Ç—Ä–µ–µ
            }
            
            // –í—Ä–µ–º—è –ø–æ–ª–µ—Ç–∞ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ç–∏–ø–∞ –Ω–∞—Å–µ–∫–æ–º–æ–≥–æ)
            const baseSpeed = 4000 + Math.random() * 2000; // 4-6 —Å–µ–∫—É–Ω–¥
            const timeModifier = Math.max(1, gameState.time / 30); // –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å
            const flightTime = (baseSpeed / timeModifier) / speedModifier;
            
            // –°–æ–∑–¥–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º requestAnimationFrame
            const startTime = Date.now();
            
            function animateInsect() {
                if (!gameState.gameActive || !insect.parentNode) return;
                
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / flightTime, 1);
                
                // –í—ã—á–∏—Å–ª—è–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é
                const currentX = startX + (endX - startX) * progress;
                const currentY = startY + (endY - startY) * progress;
                
                insect.style.left = `${currentX}px`;
                insect.style.top = `${currentY}px`;
                
                // –ï—Å–ª–∏ –∞–Ω–∏–º–∞—Ü–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
                if (progress < 1) {
                    requestAnimationFrame(animateInsect);
                } else {
                    // –£–¥–∞–ª—è–µ–º –Ω–∞—Å–µ–∫–æ–º–æ–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
                    if (insect.parentNode) {
                        insect.remove();
                        const index = gameState.insects.indexOf(insect);
                        if (index > -1) {
                            gameState.insects.splice(index, 1);
                        }
                        gameState.insectsCount--;
                    }
                }
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            requestAnimationFrame(animateInsect);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞/–∫–∞—Å–∞–Ω–∏—è
            insect.addEventListener('click', () => handleInsectClick(insect, type));
            insect.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handleInsectClick(insect, type);
            }, { passive: false });
            
            gameArea.appendChild(insect);
            gameState.insects.push(insect);
            gameState.insectsCount++;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            switch(type) {
                case 'ü¶ü': gameState.stats.mosquitoes++; break;
                case 'üêù': gameState.stats.bees++; break;
                case 'üêû': gameState.stats.ladybugs++; break;
                case 'ü™∞': gameState.stats.flies++; break;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –Ω–∞—Å–µ–∫–æ–º–æ–º—É
        function handleInsectClick(insect, type) {
            if (!gameState.gameActive) return;
            
            // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è
            const rect = insect.getBoundingClientRect();
            
            // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–ø–∞–¥–∞–Ω–∏—è
            const hitEffect = document.createElement('div');
            hitEffect.className = 'hit-effect';
            hitEffect.textContent = 'üí•';
            
            // –ö–æ–ø–∏—Ä—É–µ–º –ø–æ–∑–∏—Ü–∏—é –Ω–∞—Å–µ–∫–æ–º–æ–≥–æ
            hitEffect.style.left = insect.style.left;
            hitEffect.style.top = insect.style.top;
            
            document.getElementById('gameArea').appendChild(hitEffect);
            
            // –£–¥–∞–ª–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ 0.5 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (hitEffect.parentNode) hitEffect.remove();
            }, 500);
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –Ω–∞—Å–µ–∫–æ–º–æ–≥–æ
            if (insect.parentNode) {
                insect.remove();
                const index = gameState.insects.indexOf(insect);
                if (index > -1) {
                    gameState.insects.splice(index, 1);
                }
                gameState.insectsCount--;
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –Ω–∞—Å–µ–∫–æ–º–æ–≥–æ
            switch(type) {
                case 'ü¶ü': // –ö–æ–º–∞—Ä—ã
                    gameState.score++;
                    resetTimer(); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –ø—Ä–∏ —É–±–∏–π—Å—Ç–≤–µ –∫–æ–º–∞—Ä–∞
                    updateGameDisplay();
                    break;
                    
                case 'üêù': // –ü—á–µ–ª—ã
                    gameState.health--;
                    updateGameDisplay();
                    if (gameState.health <= 0) {
                        endGame("–ó–¥–æ—Ä–æ–≤—å–µ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å!");
                    }
                    break;
                    
                case 'üêû': // –ë–æ–∂—å–∏ –∫–æ—Ä–æ–≤–∫–∏
                    if (gameState.health < gameState.maxHealth) {
                        gameState.health++;
                        updateGameDisplay();
                    }
                    break;
                    
                case 'ü™∞': // –ú—É—Ö–∏
                    // –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º, –ø—Ä–æ—Å—Ç–æ –æ—Ç–≤–ª–µ–∫–∞—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç
                    break;
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞—Å–µ–∫–æ–º—ã—Ö
        function generateInsects() {
            if (!gameState.gameActive) return;
            
            // –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏–≥—Ä–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏
            const { width, height } = getGameAreaSize();
            
            // –ï—Å–ª–∏ –æ–±–ª–∞—Å—Ç—å —Å–ª–∏—à–∫–æ–º –º–∞–ª–∞, –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–∞—Å–µ–∫–æ–º—ã—Ö
            if (width < 100 || height < 100) return;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—Å–µ–∫–æ–º—ã—Ö –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
            const baseCount = 3;
            const timeBonus = Math.floor(gameState.time / 30); // –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ +1 –Ω–∞—Å–µ–∫–æ–º–æ–µ
            
            // –£—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞: –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –Ω–∞—Å–µ–∫–æ–º—ã—Ö
            const screenFactor = Math.min(width * height / (400 * 800), 1.5); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∫ —ç—Ç–∞–ª–æ–Ω—É 400x800
            const maxInsects = Math.min(baseCount + timeBonus, Math.floor(8 * screenFactor)); // –º–∞–∫—Å–∏–º—É–º –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
            
            // –ï—Å–ª–∏ –Ω–∞—Å–µ–∫–æ–º—ã—Ö –º–µ–Ω—å—à–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ
            if (gameState.insectsCount < maxInsects) {
                // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö –Ω–∞—Å–µ–∫–æ–º—ã—Ö
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à–∞–Ω—Å –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–æ–º–∞—Ä–æ–≤, —á—Ç–æ–±—ã –∏–≥—Ä–æ–∫ –º–æ–≥ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å —Ç–∞–π–º–µ—Ä
                const insectTypes = ['ü¶ü', 'ü¶ü', 'ü¶ü', 'ü¶ü', 'ü¶ü', 'ü¶ü', 'üêù', 'üêù', 'üêû', 'ü™∞', 'ü™∞'];
                const randomType = insectTypes[Math.floor(Math.random() * insectTypes.length)];
                createInsect(randomType);
            }
            
            // –ü–ª–∞–Ω–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å —É—á–µ—Ç–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
            const baseInterval = 1200;
            const timePenalty = Math.min(gameState.time * 8, 400); // —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —á–∞—Å—Ç–æ—Ç—É –¥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥–µ–ª–∞
            
            // –ù–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö –Ω–∞—Å–µ–∫–æ–º—ã–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ä–µ–∂–µ
            const screenSizePenalty = width < 300 ? 300 : 0;
            
            const nextGeneration = Math.max(baseInterval - timePenalty + screenSizePenalty, 600); // –º–∏–Ω–∏–º—É–º 600–º—Å
            
            setTimeout(generateInsects, nextGeneration);
        }

        // –¢–∞–π–º–µ—Ä –∏–≥—Ä—ã
        function startGameTimer() {
            gameState.gameTimeInterval = setInterval(() => {
                if (gameState.gameActive) {
                    gameState.time++;
                    updateGameDisplay();
                }
            }, 1000);
        }

        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
        function startGame() {
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
            gameState.score = 0;
            gameState.time = 0;
            gameState.health = 5;
            gameState.timerValue = 10;
            gameState.gameActive = true;
            gameState.insects = [];
            gameState.insectsCount = 0;
            gameState.stats = { mosquitoes: 0, bees: 0, ladybugs: 0, flies: 0 };
            
            // –û—á–∏—Å—Ç–∫–∞ –∏–≥—Ä–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏
            const gameArea = document.getElementById('gameArea');
            if (gameArea) {
                gameArea.innerHTML = '<div class="game-area-border"></div>';
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∏–≥—Ä–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏
            getGameAreaSize();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏—Å–ø–ª–µ—è
            updateGameDisplay();
            
            // –ü–æ–∫–∞–∑ –∏–≥—Ä–æ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('statsScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–æ–≤
            if (gameState.gameTimeInterval) {
                clearInterval(gameState.gameTimeInterval);
            }
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            startGameTimer();
            startTimer();
            
            // –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞—Å–µ–∫–æ–º—ã—Ö —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
            setTimeout(() => {
                generateInsects();
            }, 300);
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –Ω–∞—Å–µ–∫–æ–º—ã—Ö
        function clearAllInsects() {
            const gameArea = document.getElementById('gameArea');
            if (gameArea) {
                gameArea.innerHTML = '<div class="game-area-border"></div>';
            }
            gameState.insects = [];
            gameState.insectsCount = 0;
        }

        // –û–∫–æ–Ω—á–∞–Ω–∏–µ –∏–≥—Ä—ã
        function endGame(reason = "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞") {
            gameState.gameActive = false;
            
            // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Ç–∞–π–º–µ—Ä–æ–≤
            if (gameState.gameTimeInterval) {
                clearInterval(gameState.gameTimeInterval);
            }
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            gameStats.totalGames++;
            gameStats.totalMosquitoes += gameState.score;
            
            if (gameState.score > gameStats.bestMosquitoes) {
                gameStats.bestMosquitoes = gameState.score;
            }
            
            if (gameState.time > gameStats.bestTime) {
                gameStats.bestTime = gameState.time;
            }
            
            saveStats();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('finalTime').textContent = gameState.time;
            document.getElementById('endReason').textContent = reason;
            document.getElementById('endMosquitoes').textContent = gameState.stats.mosquitoes;
            document.getElementById('endBees').textContent = gameState.stats.bees;
            document.getElementById('endLadybugs').textContent = gameState.stats.ladybugs;
            document.getElementById('endFlies').textContent = gameState.stats.flies;
            
            // –ü–æ–∫–∞–∑ —ç–∫—Ä–∞–Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.remove('hidden');
            
            // –û—á–∏—Å—Ç–∫–∞ –∏–≥—Ä–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏
            clearAllInsects();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById('startButton').addEventListener('click', startGame);
        document.getElementById('restartButton').addEventListener('click', startGame);
        
        document.getElementById('showStatsButton').addEventListener('click', () => {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('statsScreen').classList.remove('hidden');
        });
        
        document.getElementById('backToMenuButton').addEventListener('click', () => {
            document.getElementById('statsScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        });
        
        document.getElementById('menuButton').addEventListener('click', () => {
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
            clearAllInsects();
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏–≥—Ä–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏
                getGameAreaSize();
                
                // –ï—Å–ª–∏ –∏–≥—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞—Å–µ–∫–æ–º—ã—Ö
                if (gameState.gameActive) {
                    // –û—á–∏—â–∞–µ–º –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –Ω–∞—Å–µ–∫–æ–º—ã—Ö
                    clearAllInsects();
                    setTimeout(generateInsects, 300);
                }
            }, 200);
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã —Å–∏—Å—Ç–µ–º—ã
        const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        mediaQuery.addEventListener('change', () => {
            updateThemeIndicator();
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–º—ã
            document.body.style.background = `linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%)`;
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        window.addEventListener('DOMContentLoaded', () => {
            loadStats();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏–≥—Ä–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏
            getGameAreaSize();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–µ–º—ã
            updateThemeIndicator();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            if ('ontouchstart' in window) {
                document.body.style.cursor = 'pointer';
            }
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é –Ω–∞ –¥–ª–∏–Ω–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
    </script>
</body>
</html>
